local Box = require('box')

local EX1 = [[
00000000000000000000000000000000000000000
01100111001111001110011111001111100001000
01100101001001001110010101001010100011100
00000111001001001110011111001101100110110
00100000001111000000010101001010100011100
01110010000000000000011111001111100001000
00100000000000000000000000000000000000000
00000000000000000000000000000000000000000
02200222002222002220022222002222200002000
02200202002002002220020202002020200022200
00000222002002002220022222002202200220220
00200000002222000000020202002020200022200
02220020000000000000022222002222200002000
00200000000000000000000000000000000000000
00000000000000000000000000000000000000000
03300333003333003330033333003333300003000
03300303003003003330030303003030300033300
00000333003003003330033333003303300330330
00300000003333000000030303003030300033300
03330030000000000000033333003333300003000
00300000000000000000000000000000000000000
00000000000000000000000000000000000000000
01200121001221001110011211001121100002000
02100202002002001210010101001010100012100
00000121002002001110021212002101200220220
00100000001221000000010101001010100012100
01210000000000000000011211001121100002000
00100000000000000000000000000000000000000
00000000000000000000000000000000000000000
02100212002112002220022122002212200001000
01200101001001002120020202002020200021200
00000212001001002220012121001202100110110
00200000002112000000020202002020200021200
02120000000000000000022122002212200001000
00200000000000000000000000000000000000000
00000000000000000000000000000000000000000
01300131001331001110011311001131100003000
03100303003003001310010101001010100013100
00000131003003001110031313003101300330330
00100000001331000000010101001010100013100
01310000000000000000011311001131100003000
00100000000000000000000000000000000000000
00000000000000000000000000000000000000000
03100313003113003330033133003313300001000
01300101001001003130030303003030300031300
00000313001001003330013131001303100110110
00300000003113000000030303003030300031300
03130000000000000000033133003313300001000
00300000000000000000000000000000000000000
00000000000000000000000000000000000000000
01300131001333100111001113111000000000000
03100303003000300131001001001000000000000
00000131003000300111001001001000000000000
00100000003000300000003110113000000000000
01310000001333100000001001001000000000000
00100000000000000000001001001000000000000
00000000000000000000001113111000000000000
00000000000000000000000000000000000000000]]

local function split( s )
	local t = {}
	for line in s:gmatch('%S+') do
		local tt = {}
		for ch in line:gmatch('.') do
			tt[#tt+1] = ch
		end
		t[#t+1] = tt 
	end
	return t
end

local function make( s )
	local t = {}
	for i = 2, #s-1 do
		local tt = {}
		for j = 2, #s[i]-1 do
			local ch = 'L_0000'
			if s[i][j] ~= '0' then
				ch = ('L_%s%s%s%s'):format( s[i][j-1], s[i-1][j], s[i][j+1], s[i+1][j] )
				if ch == 'L_0000' then
					ch = ('L_%s%s%s%s'):format( s[i][j], s[i][j], s[i][j], s[i][j] )
				end
			end
			tt[#tt+1] = Box[ch] or ' '
		end
		t[#t+1] = table.concat( tt )
	end
	return table.concat( t, '\n' )
end

print( make( split( EX1 ))) 
